<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.141.0"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="map[homepage:https://sumercip.com/ name:Sümer Cip]"><meta property="og:url" content="https://sumercip.com/posts/making-python-fitter-and-faster/"><link rel=canonical href=https://sumercip.com/posts/making-python-fitter-and-faster/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css><link rel=apple-touch-icon href=/images/favico.svg><link rel=icon type=image/svg+xml href=/images/favico.svg><link rel=shortcut href=/images/favico.svg><link rel=alternate type=application/atom+xml href=https://sumercip.com/index.xml title="Welcome! | Sümer Cip"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sumercip.com\/"},"articleSection":"posts","name":"In the Making of Python Fitter and Faster","headline":"In the Making of Python Fitter and Faster","description":"How Python\u0027s recent performance improvements work under the hood","inLanguage":"en-US","author":"Sümer Cip","creator":"Sümer Cip","publisher":"Sümer Cip","accountablePerson":"Sümer Cip","copyrightHolder":"Sümer Cip","copyrightYear":"2024","datePublished":"2024-10-04 18:49:37 \u002b0300 \u002b0300","dateModified":"2024-10-04 18:49:37 \u002b0300 \u002b0300","url":"https:\/\/sumercip.com\/posts\/making-python-fitter-and-faster\/","keywords":[]}</script><title>In the Making of Python Fitter and Faster</title>
<meta property="og:title" content="In the Making of Python Fitter and Faster"><meta property="og:type" content="article"><meta property="og:description" content="How Python's recent performance improvements work under the hood"><meta name=description content="How Python's recent performance improvements work under the hood"><meta property="og:locale" content="en-us"><style>body{font-family:inter,sans-serif;line-height:1.5;-webkit-font-smoothing:antialiased;margin:0 20px;background-color:#fed6a1;background-size:40px 40px;background-position:-19px -19px}h1{font-size:1.5em}h1,h2,h3,h4,h5,h6{font-family:inter,sans-serif}blockquote{margin-block-start:0;margin-block-end:0;margin-inline-start:0;margin-inline-end:0;border-left:5px solid #747474;padding-left:20px;font-style:italic;color:#747474;font-family:Crimson Text,serif;font-size:1.1em}.blockquote p{margin-inline-start:40px}strong{font-weight:600}ol{padding-inline-start:20px}ul{padding-inline-start:40px}article{max-width:680px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{text-decoration:underline;color:#f41d92}.progress-indicator{position:fixed;top:0;width:100%;z-index:10;height:5px;background-color:#f41d92}.post-ads{margin:50px 0}.markdown-body{font-size:1.1em;max-width:100%}.markdown-body a{text-decoration:underline}.markdown-body pre{padding:4px;overflow:auto;border-radius:1px;padding:20px;box-shadow:6px 6px rgba(0,0,0,.1);border:1px solid rgba(0,0,0,5%);margin:0;line-height:normal}.markdown-body code{display:inline-block;--tw-bg-opacity:1;font-size:.8em;font-family:monospace,Fira Code;margin-bottom:2px;border-radius:4px}.markdown-body a code{text-decoration:underline;color:inherit}.markdown-body pre>code{padding:0;font-size:80%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:1.3rem;font-weight:900;margin-top:32px;font-family:inter,sans-serif}.logo__cursor{display:inline-block;width:10px;height:1rem;background:#f41d92;border-radius:1px;-webkit-animation:cursor 1s infinite;animation:cursor 1s infinite}@-webkit-keyframes cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes cursor{0%{opacity:0}50%{opacity:1}to{opacity:0}}.logo__mark .greater-icon{width:.95rem;height:100%}svg:not(:root){overflow-clip-margin:content-box;overflow:hidden}.header-title a{text-decoration:none}.header-subtitle{color:#747474;font-size:1.1em}.header-items{margin:10px 0}.header-item{margin:0 5px;font-weight:600}.header-line{width:100%;border-width:1px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-date{color:#747474;font-weight:400;font-size:1rem}.posts-title{font-size:1.2rem;font-weight:600;font-family:inter}.posts-line{font-size:1.2rem;margin:20px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;display:block;margin:0 auto}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:900;margin-block-start:0;margin-block-end:0}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}hr{margin:2em 0;border:0}hr:after{content:"...";text-align:center;display:block;letter-spacing:.6em;font-size:1.1em}.page-content{min-height:60%}.post-content{}.post-content p{hyphens:auto;text-justify:ideographic;margin-bottom:1.1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-subtitle,.header-items{text-align:center}.posts-line{font-size:1.1em}.markdown-body{font-size:1.1em}.post-title{font-size:2em}.post-content p{}}@media screen and (max-width:48em){.posts-category{display:none}}.chroma{background-color:#fdf2e6}.chroma .x{}.chroma .err{color:#a61717;background-color:#e3d2d2}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:hidden;display:block}.chroma .hl{display:block;width:100%;background-color:#fafa64}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#000;font-weight:700}.chroma .kc{color:#000;font-weight:700}.chroma .kd{color:#000;font-weight:700}.chroma .kn{color:#000;font-weight:700}.chroma .kp{color:#000;font-weight:700}.chroma .kr{color:#000;font-weight:700}.chroma .kt{color:#458;font-weight:700}.chroma .n{}.chroma .na{color:teal}.chroma .nb{color:#0086b3}.chroma .bp{color:#999}.chroma .nc{color:#458;font-weight:700}.chroma .no{color:teal}.chroma .nd{color:#3c5d5d;font-weight:700}.chroma .ni{color:purple}.chroma .ne{color:#900;font-weight:700}.chroma .nf{color:#900;font-weight:700}.chroma .fm{}.chroma .nl{color:#900;font-weight:700}.chroma .nn{color:#555}.chroma .nx{}.chroma .py{}.chroma .nt{color:navy}.chroma .nv{color:teal}.chroma .vc{color:teal}.chroma .vg{color:teal}.chroma .vi{color:teal}.chroma .vm{}.chroma .l{}.chroma .ld{}.chroma .s{color:#d14}.chroma .sa{color:#d14}.chroma .sb{color:#d14}.chroma .sc{color:#d14}.chroma .dl{color:#d14}.chroma .sd{color:#d14}.chroma .s2{color:#d14}.chroma .se{color:#d14}.chroma .sh{color:#d14}.chroma .si{color:#d14}.chroma .sx{color:#d14}.chroma .sr{color:#009926}.chroma .s1{color:#d14}.chroma .ss{color:#990073}.chroma .m{color:#099}.chroma .mb{color:#099}.chroma .mf{color:#099}.chroma .mh{color:#099}.chroma .mi{color:#099}.chroma .il{color:#099}.chroma .mo{color:#099}.chroma .o{color:#000;font-weight:700}.chroma .ow{color:#000;font-weight:700}.chroma .p{}.chroma .c{color:#998;font-style:italic}.chroma .ch{color:#998;font-style:italic}.chroma .cm{color:#998;font-style:italic}.chroma .c1{color:#998;font-style:italic}.chroma .cs{color:#999;font-weight:700;font-style:italic}.chroma .cp{color:#999;font-weight:700;font-style:italic}.chroma .cpf{color:#999;font-weight:700;font-style:italic}.chroma .g{}.chroma .gd{color:#000;background-color:#fdd}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#a00}.chroma .gh{color:#999}.chroma .gi{color:#000;background-color:#dfd}.chroma .go{color:#888}.chroma .gp{color:#555}.chroma .gs{font-weight:700}.chroma .gu{color:#aaa}.chroma .gt{color:#a00}.chroma .gl{text-decoration:underline}.chroma .w{color:#bbb}details.toc-container summary{padding:.5em;font-weight:700;cursor:pointer;background:lightgrey}details.toc-container{border:1px solid var(--stable-color);background-color:#fdf2e6;box-shadow:6px 6px rgba(0,0,0,.15)}.toc{padding:.5em}.toc a{display:block;text-decoration:underline;font-size:1.1em}details[open]>summary:first-of-type{list-style-type:disclosure-open}user agent stylesheet details>summary:first-of-type{list-style:inside disclosure-closed}h2.post-desc{margin:unset;color:#747474;font-size:1.4em;font-weight:400}h1.post-title{line-height:1.1}.citation{position:relative;cursor:pointer;color:#5e1fff;padding-bottom:10px;font-size:75%;vertical-align:super}.citation-tooltip{position:absolute;top:calc(100%);left:-10px;border:1px solid #000;padding:15px;border-radius:8px;box-shadow:rgba(28,14,64,.15)0 .125rem .5rem;visibility:hidden;opacity:0;transition:visibility 0s,opacity .3s ease;z-index:10;max-width:316px;width:316px;word-wrap:break-word;color:#333;background-color:#fdf2e6}.citation:hover .citation-tooltip,.citation-tooltip:hover,.citation:focus-within .citation-tooltip{visibility:visible;opacity:1}.citation-tooltip::after{content:"";position:absolute;top:-13px;left:5%;transform:translateX(-50%);border-width:7px;border-style:solid;border-color:transparent transparent #fdf2e6 transparent}.citation-tooltip::before{content:"";position:absolute;top:-16px;left:5%;transform:translateX(-50%);border-width:8px;border-style:solid;border-color:transparent transparent #000 transparent}.citation-tooltip::before,.citation-tooltip::after{pointer-events:none}.citation:hover,.citation-tooltip:hover{outline:none}</style><style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style><link href=/index.xml rel=alternate type=application/rss+xml title="Welcome! | Sümer Cip"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400&family=Inter:wght@600&family=Inter:wght@900&family=Fira+Code&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Inter Tight:wght@400&family=Inter Tight:wght@600&family=Inter Tight:wght@900&family=Crimson+Text" rel=stylesheet></head><body><article class=post id=article><div class=row><div class=col-xs-12><div class=site-header><header><a href=/ class=logo style=text-decoration:none><div class=header-title><a href=/>Sümer Cip</a>
<span class=logo__cursor></span>
<a href=/index.xml target=_blank style=float:right><i class="fas fa-rss"></i>
</a><a href=https://twitter.com/sumercip target=_blank style=float:right;margin-right:8px><i class="fab fa-twitter"></i>
</a><a href=https://github.com/sumerc target=_blank style=float:right;margin-right:8px><i class="fab fa-github"></i></a></div><div class=header-subtitle>My notes on random stuff about tech</div></header><div class="row end-md center-xs header-items"><div class=header-item><a href=/>Home</a></div><div class=header-item><a href=/articles>Articles</a></div><div class=header-item><a href=/talks>Talks</a></div><div class=header-item><a href=/about>About</a></div></div><div class="row end-xs"></div><div class=header-line></div>&nbsp;
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154918616-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-154918616-1")</script></div><header class=post-header></br><div class="row post-desc"><div class=col-xs-12><time class=posts-date datetime="04 Oct 2024">04 Oct 2024 · 9 min read</time></div></div><h1 class=post-title>In the Making of Python Fitter and Faster</h1><h2 class=post-desc>How Python's recent performance improvements work under the hood</h2></header><details class=toc-container open><summary>Table of Contents</summary><div class=toc><ul><li><a href=#pythons-performance-revolution>Python’s Performance Revolution</a></li><li><a href=#no-free-lunch-the-science-and-sweat-behind-the-speed>No Free Lunch: The Science and Sweat Behind the Speed</a></li><ul><li><a href=#1-specialized-adaptive-interpreter>Specialized, Adaptive Interpreter</a></li><li><a href=#2-better-memory-management>Better Memory Management</a></li><li><a href=#3-jit>JIT</a></li></ul><li><a href=#crossing-the-finish-line>Crossing the Finish Line</a></li></ul></div></details><hr></hr><div class="post-content markdown-body" data-progress-indicator><h1 id=pythons-performance-revolution>Python’s Performance Revolution</h1><p><img src=/yess.png alt></p><p>Since Python 3.11, there has been a strong, ongoing effort to make Python faster, and the results are clear. Performance improvements are real, and the work continues.</p><p>It&rsquo;s both refreshing and surprising to see such significant speed gains in a language that&rsquo;s nearly 30 years old.</p><p>But make no mistake: there&rsquo;s no magic here. In my humble opinion, the success can be attributed to a few key factors:</p><ul><li><p><strong>Dedication</strong>: People, including Guido van Rossum himself, are working full-time on making Python faster. This commitment is crucial. It enables bold, low-level, core changes that drive performance improvements.</p></li><li><p><strong>Talent and Effort</strong>: <a href=https://www.linkedin.com/in/mark-shannon-bb459551/>Mark Shannon</a> has been grappling with this problem for nearly a decade, refining ideas and approaches over time. Including talented people like <a href="https://www.youtube.com/watch?v=kMO3Ju0QCDo">Brandt Bucher</a> and many more…</p></li><li><p><strong>Approachability</strong>: CPython’s codebase remains approachable and relatively simple, which fosters experimentation. Complex optimizations, like part of JIT compilation, have been implemented by <a href="https://www.youtube.com/watch?v=p57zI4qPVZY">two undergraduate students</a> within two years, highlighting the fact that it does not require years of expertise to be around the development.</p></li><li><p><strong>Accumulation of Quality Profiling Data</strong>: This aspect is somewhat overlooked in my opinion.</p><p>Python is widely used across many industries, which has led to an extensive accumulation of quality profiling data. This data, drawn from real-world production workloads like <a href="https://www.youtube.com/watch?v=xGY45EmhwrE">Instagram’s Cinder</a> and platforms like <a href=http://speed.python.org>speed.python.org</a> and many more helps pinpoint hot spots.</p><p>This data-driven approach ensures optimizations are targeted where they matter most. There was no room for premature optimization from the start.</p><p>See <a href="https://www.youtube.com/watch?v=dgrtgtT-UXM">Shannon’s talk</a>, listing the execution time per component:</p></li></ul><p><img src=/shannon1.png alt="Shannon&rsquo;s Talk"></p><h1 id=no-free-lunch-the-science-and-sweat-behind-the-speed>No Free Lunch: The Science and Sweat Behind the Speed</h1><p>There’s no free lunch, though.</p><p>These improvements are the result of deliberate planning and research. The goal of a <strong>~5x speedup</strong> was set even before implementation began.</p><p>Established languages like Node.js and Java, which have long used some of these techniques, also served as inspiration.</p><p>Before diving into the key techniques used, let’s first review the timeline to get a high-level view of the performance improvements:</p><p><img src=/timeline1.png alt="Python timeline"></p><h3 id=1-specialized-adaptive-interpreter>1. Specialized, Adaptive Interpreter</h3><p>Let’s see what “specializing” and “adaptive” mean with a real example. Think about the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>def</span> <span class=nf>mul</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>x</span> <span class=o>*</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>mul</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=mi>3</span>           <span class=mi>0</span> <span class=n>RESUME</span>                   <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=mi>4</span>           <span class=mi>2</span> <span class=n>LOAD_FAST</span>                <span class=mi>0</span> <span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=mi>4</span> <span class=n>LOAD_FAST</span>                <span class=mi>1</span> <span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>              <span class=mi>6</span> <span class=n>BINARY_OP</span>                <span class=mi>5</span> <span class=p>(</span><span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=mi>10</span> <span class=n>RETURN_VALUE</span></span></span></code></pre></div><p>Python VM is a stack based interpreter. As can be seen from the bytecode, to do an arithmetic operation, it first need to push the variables onto the stack and performs the operations there.</p><p>Let’ see what happens when we call this function few more times:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mf>3.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>11</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span>     <span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mf>3.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>mul</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=mi>3</span>           <span class=mi>0</span> <span class=n>RESUME_QUICK</span>             <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=mi>4</span>           <span class=mi>2</span> <span class=n>LOAD_FAST__LOAD_FAST</span>     <span class=mi>0</span> <span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=mi>4</span> <span class=n>LOAD_FAST</span>                <span class=mi>1</span> <span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>            <span class=mi>6</span> <span class=n>BINARY_OP_ADAPTIVE</span>       <span class=mi>5</span> <span class=p>(</span><span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=mi>10</span> <span class=n>RETURN_VALUE</span></span></span></code></pre></div><p>Few changes already! Let’s inspect one by one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class="line hl"><span class=cl><span class=mi>0</span> <span class=n>RESUME_QUICK</span>             <span class=mi>0</span></span></span></code></pre></div><p>The first change is being the <code>RESUME</code> -> <code>RESUME_QUICK</code> change. It is a quickened form of <code>RESUME</code>: it skips some of the setup and check that <code>RESUME</code> performs.</p><p>This process is part of specialization, where the interpreter replaces one or more instructions with more efficient ones based on observed patterns. We call this faster variants <strong>superinstructions</strong>.</p><p>It&rsquo;s important to note that Python specializes one bytecode at a time.</p><p>It doesn’t attempt to understand the broader context of what the application is doing to find the most optimal superinstruction for a particular problem. In compilers, such optimizations are possible—you can even implement something like <code>strlen</code> using a set of assembly instructions.</p><p>Python doesn’t take this approach. Its specialization is more limited, operating on a per-instruction basis.</p><p>The second is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class="line hl"><span class=cl><span class=n>LOAD_FAST__LOAD_FAST</span>     <span class=mi>0</span> <span class=p>(</span><span class=n>x</span><span class=p>)</span></span></span></code></pre></div><p>In a stack-based VM, as one might expect, pushing and popping values to and from the stack are likely the most frequent operations.</p><p>Instead of issuing multiple <code>LOAD_FAST</code> instructions for variables like x and y, the interpreter merges them into a single instruction: <code>LOAD_FAST__LOAD_FAST</code>.</p><p>Let’s move on:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class="line hl"><span class=cl><span class=n>BINARY_OP_ADAPTIVE</span>       <span class=mi>5</span> <span class=p>(</span><span class=o>*</span><span class=p>)</span></span></span></code></pre></div><p>Notice how <code>BINARY_OP</code> becomes <code>BINARY_OP_ADAPTIVE</code>? This is again part of the specialization process, but here we are in an earlier phase: <strong>quickening</strong>.</p><p>During quickening, the interpreter identifies operations that could benefit from optimization.</p><p>In this case, the instruction is flagged as a potential candidate for specialization, but it hasn&rsquo;t been applied yet. Why?</p><p>The answer lies in how we call it: we were adding an int (2) and and float (3.0). Modern CPUs have specialized instructions for efficiently handling arithmetic operations on integers, floats or even strings of the same type. If both operands had been of the same type, the interpreter would have used a specialized version of the instruction.</p><p>Instead, it marks the operation as <strong>adaptive</strong>, meaning the instruction might benefit from specialization in future executions if consistent type patterns are observed.</p><p>Let’s call our function 11 more times, but this time only with float’s:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>11</span><span class=p>):</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span>     <span class=n>mul</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span> <span class=mf>3.0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>dis</span><span class=o>.</span><span class=n>dis</span><span class=p>(</span><span class=n>mul</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>4</span>           <span class=mi>2</span> <span class=n>LOAD_FAST__LOAD_FAST</span>     <span class=mi>0</span> <span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=mi>4</span> <span class=n>LOAD_FAST</span>                <span class=mi>1</span> <span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>            <span class=mi>6</span> <span class=n>BINARY_OP_MULTIPLY_FLOAT</span>     <span class=mi>5</span> <span class=p>(</span><span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=mi>10</span> <span class=n>RETURN_VALUE</span></span></span></code></pre></div><p>Notice the change? The adaptive instruction is gone. Interpreter became confident enough to optimize this code by replacing the instruction with a specialized one: <code>BINARY_OP_MULTIPLY_FLOAT</code>. This is called <strong>specialization.</strong></p><p>There are tradeoffs though. One of them is memory&ndash; each specialization introduces a small memory cost, as the interpreter needs to store runtime information alongside the instruction. This is managed through an <strong>inline cache</strong>.</p><p>Inline caches are dynamically managed to avoid excessive memory consumption and the system falls back to generic execution if cache misses occur frequently. The <a href=https://peps.python.org/pep-0659/#costs>PEP</a> also provides a detailed analysis of memory usage related to this process.</p><p>Before we move further, please let’s pause to consider and appreciate what just happened. The interpreter optimized the code at runtime by collecting data and making bytecode-level adjustments based on that information, leading to faster execution! If this is not something impressive and inspiring, I don’t know what is.</p><h3 id=2-better-memory-management>2. Better Memory Management</h3><p>Less memory almost always means better cache utilization, thus optimizing for memory brings <strong>compounding benefits</strong>.</p><p>In <a href="https://www.youtube.com/watch?v=dgrtgtT-UXM">this talk</a>, Mark Shannon discusses how they reduced the size of the base Python object. Since everything in Python is an object, minimizing the memory footprint of Python objects is almost always beneficial. The talk goes into the finer details on how this was achieved over the years.</p><p>I’d like to provide a brief summary of what I learned from the talk:</p><p><img src=/memtimeline.png alt></p><p>In summary, object size has been reduced by approximately ~75% and memory reads to access a variable also reduced by ~60%.</p><p>This result serves as a real-world example on the compounding effect we mentioned earlier: the smaller object size leads to fewer indirections when accessing attributes, further enhancing performance.</p><p>Reducing memory is still a top priority and we will definitely see more improvements in this area. Python 3.13 introduced better heuristics for garbage collection (GC) cycles, leading to more efficient collection of cyclic references and reduced GC pause times.</p><h3 id=3-jit>3. JIT</h3><p>JIT compiler is an <a href=https://docs.python.org/3.13/whatsnew/3.13.html#an-experimental-just-in-time-jit-compiler>experimental feature</a> in 3.13 and <a href=https://peps.python.org/pep-0744/>PEP 744</a> describes how it works under the hood.</p><p>The previous improvements from the specialized, adaptive interpreter and having an inline cache per instruction paves the way for JIT compilation. Now, with JIT, we compile the specialized code to machine code.</p><p><img src=/jittimeline.png alt></p><p>From the release notes:</p><blockquote><p>The machine code translation process uses a technique called copy-and-patch. It has no runtime dependencies, but there is a new build-time dependency on LLVM.</p></blockquote><p>Before delving deep to explain what what this copy-and-patch means, let’s take a step back and have a 10.000 foot view on how JIT compilers work:</p><p><img src=/jitoverview.png alt></p><p>Interpreted languages like Java,Node.js and Python work on intermediate bytecode.</p><p>The VM executes this bytecode and with the help of an efficient runtime profiler, hot spots in the code are identified. These hotspots are then sent to <strong>JIT(Just-In-Time)</strong> compiler to be compiled to machine code.</p><p>For example, the Java Virtual Machine (JVM) leverages the LLVM framework to convert these hotspot bytecodes into machine code, allowing the runtime to switch to native instructions for faster execution.</p><p>Another method, called <strong>AOT(Ahead-Of-Time)</strong> Compilation, can also be used to complement JIT compilation. In AOT, parts of the code are optimized and compiled even before the program is run. Since there is no runtime profiling data available, AOT relies on static code analysis and heuristic techniques to predict potential hotspots.</p><p>Python, on the other hand, adopts a distinct and somewhat novel approach called <strong>“copy-and-patch.”</strong></p><p>There is a <a href=https://dl.acm.org/doi/10.1145/3485513>paper</a> elaborating this technique.</p><p>The concept is similar to traditional JIT compilers: Python performs a tracing step to identify potential hotspots and then converts them to machine code. Instead of dynamically compiling code, static pre-compiled bytecodes are copied into memory and patched during runtime. This means that as the program executes, only specific segments of the machine code are modified on-the-fly—hence the term “copy-and-patch.”</p><p>In this <a href="https://www.youtube.com/watch?v=kMO3Ju0QCDo">insightful talk</a>, Brandt Bucher provides a perfect demonstration of how copy-and-patch works under the hood.</p><p>Here is my attempt to visualize the concept based on what I learned from the talk:</p><p><img src=/jitflow.png alt></p><p>A specific bytecode identified for optimization is selected, and the corresponding C code is extracted to a separate file with modifications to enable runtime patching. This modified file is then compiled into machine code using LLVM. The resulting machine code is formatted into a C header file in a <a href=https://en.wikipedia.org/wiki/Shellcode>shellcode-like</a> structure. The final product is a <strong>platform-specific, patchable segment of machine code</strong> that the JIT compiler can utilize as needed.</p><p>This approach has several benefits:</p><ul><li><p><strong>No Runtime Dependency</strong>: With copy-and-patch, there’s no need for a separate runtime compilation step, which eliminates the need for a compiler dependency in the interpreter.</p></li><li><p><strong>Simplicity</strong>: This method achieves broad platform support by simply writing template JIT code in C. Python core developers don’t have to delve into platform-specific assembly, making maintenance easier and the approach more accessible to contributors.</p></li><li><p><strong>Performance</strong>:Since there’s no full-scale compilation step, the overhead is significantly reduced. According to Brandt’s <a href="https://www.youtube.com/watch?v=kMO3Ju0QCDo">talk</a>, the copy-and-patch method results in approximately ~100x faster code generation and ~15% faster execution compared to a traditional JIT toolchain.</p><p>While it may not match the performance of a handcrafted assembly JIT like LuaJIT in every scenario, it offers comparable compilation speeds and is only around ~35% slower in execution on certain benchmarks.</p></li></ul><p>It’s still early days for this approach, but it’s undeniably a promising and more approachable alternative to implementing a full-fledged JIT compiler.</p><h1 id=crossing-the-finish-line>Crossing the Finish Line</h1><p>The results speak for themselves.</p><p>From the official release notes(<a href=https://docs.python.org/3/whatsnew/3.11.html#faster-cpython)>https://docs.python.org/3/whatsnew/3.11.html#faster-cpython)</a>:</p><blockquote><p>CPython 3.11 is an average of 25% faster than CPython 3.10 as measured with the pyperformance benchmark suite, when compiled with GCC on Ubuntu Linux. Depending on your workload, the overall speedup could be ~10-60%.</p></blockquote><p>Python 3.13 introduces the initial groundwork for JIT compilation, but it’s still in its early stages.</p><p>However, with <strong>Python 3.14</strong>, JIT is expected to mature significantly, bringing tangible performance improvements.</p><p>It’s also worth noting that these performance improvements don’t just apply to pure Python code. <strong>C extensions</strong> like NumPy, Pandas, and other popular libraries could also benefit from the faster interpreter loop and reduced function call overhead.</p><p>In summary, upgrading to Python 3.11 or 3.12 can lead to significant performance improvements, making these versions highly recommended for production deployments. This trend is set to continue with Python 3.13 and beyond. For instance, in my current company, <a href=https://upsun.com/>Upsun</a>, we almost always recommend users to use the latest version of their <a href=https://docs.upsun.com/languages/python.html>runtime</a>.</p></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12></div></div><div class=site-footer align=center><hr></hr></div></div></div></article><script></script><script>(function(e,t){const o=t.querySelector("[data-progress-indicator]");if(!o)return;const n=t.createElement("div");n.classList.add("progress-indicator"),n.style.left="-100%",n.style.transform="translateX(-100%)",t.body.appendChild(n);let i=0,s=!1;e.addEventListener("scroll",function(){if(i=e.scrollY,s)return;e.requestAnimationFrame(function(){var t=Math.min(100,i/(o.scrollHeight-e.innerHeight)*100);n.style.transform=`translateX(${t}%)`,s=!1}),s=!0})})(window,document)</script></body></html>